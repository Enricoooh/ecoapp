# 

# 

# 

# **Progetto di Ingegneria del Software 2025/26**

#  **UniversitÃ  Caâ€™ Foscari Venezia** 

# 

# 

# 

# **Codice consegnato**

# 1.0

#  EcoGroup

*Document Informations*

| NomeProgetto |  | Acronimo |  |  |  |  |  |  |
| :---- | :---- | :---- | :---- | :---- | :---- | :---- | :---- | :---- |
| Deliverable | D6 |  |  |  |  |  |  |  |
| Data di Consegna | 22/12/2025 |  |   |  |  |   |  |  |
| Team Leader | Enrico Sforza |  |  |  |  |  | 902600@stud.unive.it |  |
| Team members | Enrico Rampazzo [901141@stud.unive.it](mailto:901141@stud.unive.it)Alberto Ferragosti [895936@stud.unive.it](mailto:895936@stud.unive.it) |  |  |  |  |  |  |  |

*Document History*

| Version | Issue Date | Stage | Changes | Contributors |
| :---- | :---- | :---- | :---- | :---- |
| 1.0  | 22/12/2025 | Draft | Login e registrazione | 895936 |
| 1.1 | 22/12/2025 | Draft |  Profilo | 902600 |
| 2.0 |  22/12/2025 | Final |  Quest | 901141 |

# 

GITHUB  
[https://github.com/Enricoooh/ecoapp/tree/main](https://github.com/Enricoooh/ecoapp/tree/main)

**Indice**

**[*1\. Login e registrazione	4*](#login-e-registrazione)**

[***2\. Profilo	11***](#profilo)

[***3\. Quest	11***](#quest)

# 

1. # **Login e registrazione** {#login-e-registrazione}

**1\. Panoramica**  
Implementato un sistema completo di autenticazione utente per l'applicazione Android EcoApp, comprendente registrazione, login e gestione della sessione. L'architettura segue il pattern client-server con comunicazione REST API e autenticazione basata su JWT 

**2\. Architettura Backend**  
2.1 Stack Tecnologico  
\- Node.js 18+ con framework Express 4.18.2  
\- bcryptjs 2.4.3 per hashing sicuro delle password  
\- jsonwebtoken 9.0.2 per generazione e verifica token JWT  
\- CORS 2.8.5 per cross-origin requests  
\- Database: file JSON flat (backend/users.json)  
2.2 Struttura Backend  
File principale: backend/server.js  
Endpoint implementati:  
\- POST /api/auth/register \- Registrazione nuovo utente  
\- POST /api/auth/login \- Login con email/password  
\- GET /api/user/profile \- Recupero dati profilo (protetto)  
\- PUT /api/user/profile \- Aggiornamento profilo (protetto)

2.3 Sicurezza  
\- Password hashate con bcrypt (salt rounds: 10\)  
\- Token JWT con scadenza 30 giorni  
\- Middleware authenticateToken per route protette  
\- Validazione input lato server (email formato, password min 6 caratteri)

2.4 Deployment  
\- Hosting: Render.com (free tier)  
\- URL produzione: https://ecoapp-p5gp.onrender.com  
\- Configurazione: Root Directory \= backend, Build \= npm install, Start \= npm start

**3\. Architettura Android**  
3.1 Package Struttura  
Tutto il codice auth Ã¨ isolato in com.ecoapp.android.auth/:  
\`\`\`  
auth/  
â”œâ”€â”€ LoginActivity.java  
â”œâ”€â”€ RegisterActivity.java  
â”œâ”€â”€ AuthManager.java  
â”œâ”€â”€ TokenManager.java  
â”œâ”€â”€ AuthService.java (Retrofit interface)  
â”œâ”€â”€ ApiClient.java  
â”œâ”€â”€ AuthInterceptor.java  
â””â”€â”€ models/  
    â”œâ”€â”€ User.java  
    â”œâ”€â”€ AuthResponse.java  
    â”œâ”€â”€ LoginRequest.java  
    â”œâ”€â”€ RegisterRequest.java  
    â””â”€â”€ ErrorResponse.java  
\`\`\`  
3.2 Componenti Chiave  
\#\#\#\# LoginActivity.java  
\- Gestisce il flusso di login con validazione input  
\- Layout: activity\_login.xml (tema green gaming Duolingo-style)  
\- Validazioni: formato email, password min 6 caratteri  
\- Stati UI: loading spinner, error handling con Toast  
\#\#\#\# RegisterActivity.java  
\- Registrazione con validazione completa (nome, email, password, conferma password)  
\- Layout: activity\_register.xml  
\- Feature speciale: Animazione confetti con Konfetti library al successo registrazione  
\- Delay 2 secondi pre-navigazione per godersi l'animazione  
\#\#\#\# AuthManager.java  
Singleton per gestione stato autenticazione:  
\- isAuthenticated() \- Verifica presenza token  
\- saveAuthData(token, user) \- Salva credenziali post-login/register  
\- logout() \- Cancella tutti i dati salvati  
\- getCurrentUser() \- Recupera oggetto User corrente  
\#\#\#\# TokenManager.java  
Wrapper SharedPreferences per persistenza dati:  
\- Chiavi: jwt\_token, user\_id, user\_email, user\_name  
\- Preference name: "EcoAppPrefs"  
\- Metodi CRUD: save/get/clear per ciascun campo  
\#\#\#\# ApiClient.java  
Configurazione Retrofit centralizzata:  
\- BASE\_URL: https://ecoapp-p5gp.onrender.com  
\- OkHttpClient con 30s timeout  
\- Interceptors: AuthInterceptor \+ HttpLoggingInterceptor  
\- GsonConverterFactory per serializzazione JSON  
\#\#\#\# AuthInterceptor.java  
Interceptor OkHttp per automatic JWT injection:  
\- Legge token da TokenManager  
\- Aggiunge header Authorization: Bearer {token} ad ogni request  
\- Permette chiamate senza token se non presente (per register/login)  
\#\#\#\# AuthService.java  
Retrofit Interface con endpoints tipizzati:  
\- register(@Body RegisterRequest) â†’ Call\<AuthResponse\>  
\- login(@Body LoginRequest) â†’ Call\<AuthResponse\>  
\- getProfile() â†’ Call\<User\> (JWT automatico via interceptor)

**4\. Flusso di Autenticazione**  
4.1 Registrazione  
1\. User compila form in RegisterActivity  
2\. Validazione locale: nome min 2 char, email formato valido, password min 6 char, password match  
3\. POST /api/auth/register con RegisterRequest(email, password, name)  
4\. Backend: hash password (bcrypt), salva in users.json, genera JWT 30d  
5\. Response: AuthResponse con token \+ dati user  
6\. Android: AuthManager.saveAuthData() â†’ SharedPreferences  
7\. Animazione confetti (Konfetti library, colori eco: \#58CC02, \#1CB0F6, \#FFC800, \#FF9600)  
8\. Navigazione a MainActivity dopo 2s

4.2 Login  
1\. User inserisce email/password in LoginActivity  
2\. Validazione locale: email formato, password min 6 char  
3\. POST /api/auth/login con LoginRequest(email, password)  
4\. Backend: lookup user, bcrypt compare password, genera JWT se match  
5\. Response: AuthResponse con token \+ dati user  
6\. Android: AuthManager.saveAuthData() â†’ SharedPreferences  
7\. Navigazione a MainActivity (flags: NEW\_TASK | CLEAR\_TASK)  
\#\#\# 4.3 Persistent Login  
MainActivity.java (righe 26-34):  
\`\`\`java  
AuthManager authManager \= AuthManager.getInstance(this);  
if (\!authManager.isAuthenticated()) {  
    Intent intent \= new Intent(this, LoginActivity.class);  
    startActivity(intent);  
    finish();  
    return;  
}  
\`\`\`  
Comportamento: se token presente in SharedPreferences, skip login e carica app direttamente. Login richiesto solo se token assente.  
4.4 Logout  
SettingsFragment.java:  
\- Bottone "Esci dall'account"  
\- AuthManager.logout() â†’ TokenManager.clearAll() â†’ SharedPreferences.clear()  
\- Navigazione a LoginActivity (flags: NEW\_TASK | CLEAR\_TASK)  
\- Toast conferma

**5\. Integrazioni nell'App Esistente**  
5.1 MainActivity  
Modifiche minime (8 righe aggiunte in onCreate()):  
\- Auth check all'avvio  
\- Redirect a LoginActivity se non autenticato  
\- Non toccato: QuestFragment, FriendsFragment (coordinamento team)

5.2 ProfileFragment  
ProfileFragment.java:  
\- Integrato loadUserProfile() con chiamata GET /api/user/profile  
\- Sostituite stringhe hardcoded con dati reali da backend  
\- Update UI: nome utente, livello, punti totali, CO2 risparmiata (con Locale formatting)

5.3 SettingsFragment  
SettingsFragment.java:  
\- Aggiunto MaterialButton "Esci dall'account" (rosso)  
\- Click listener â†’ performLogout() â†’ AuthManager \+ navigazione

**6\. Design UI**  
6.1 Palette Colori  
app/src/main/res/values/colors.xml:  
\`\`\`xml  
\<color name="eco\_green\_primary"\>\#58CC02\</color\>  
\<color name="eco\_blue"\>\#1CB0F6\</color\>  
\<color name="eco\_yellow"\>\#FFC800\</color\>  
\<color name="eco\_orange"\>\#FF9600\</color\>  
\<color name="eco\_background"\>\#F0F8F0\</color\>  
\`\`\`  
Ispirazione: Duolingo gaming styl3.  
6.2 Layout Features  
\- MaterialCardView con corner radius 16dp per input fields  
\- Emoji nei placeholder (ðŸ‘¤ ðŸ“§ ðŸ”’ ðŸŽ‰ ðŸš€)  
\- Bottoni 64dp altezza, corner radius 32dp, elevation 8dp  
\- ScrollView per supporto landscape/tastiere  
\- ProgressBar overlay durante chiamate API  
\- Placeholder ImageView per futura mascotte eco

6.3 Animazione Confetti  
RegisterActivity.java (metodo celebrateWithConfetti):  
\`\`\`java  
EmitterConfig emitterConfig \= new Emitter(5L, TimeUnit.SECONDS).max(100);  
Party party \= new PartyFactory(emitterConfig)  
    .shapes(Arrays.asList(Shape.Circle.INSTANCE, Shape.Square.INSTANCE))  
    .colors(Arrays.asList(0xFF58CC02, 0xFF1CB0F6, 0xFFFFC800, 0xFFFF9600))  
    .setSpeedBetween(0f, 30f)  
    .position(0.5, 0.0, 1.0, 0.0)  
    .build();  
binding.konfettiView.start(party);  
\`\`\`  
Dependency: nl.dionsegijn:konfetti-xml:2.0.4 in app/build.gradle.kts

**7\. Dipendenze Aggiunte**  
app/build.gradle.kts:  
\`\`\`kotlin  
// Networking  
implementation("com.squareup.retrofit2:retrofit:2.9.0")  
implementation("com.squareup.retrofit2:converter-gson:2.9.0")  
implementation("com.squareup.okhttp3:okhttp:4.12.0")  
implementation("com.squareup.okhttp3:logging-interceptor:4.12.0")  
implementation("com.google.code.gson:gson:2.10.1")  
// Confetti animation  
implementation("nl.dionsegijn:konfetti-xml:2.0.4")  
\`\`\`

**8\. Permessi Manifest**  
app/src/main/AndroidManifest.xml:  
\`\`\`xml  
\<uses-permission android:name="android.permission.INTERNET" /\>  
\<activity android:name="com.ecoapp.android.auth.LoginActivity" /\>  
\<activity android:name="com.ecoapp.android.auth.RegisterActivity" /\>  
\`\`\`  
**9\. Testing & Debugging**  
9.1 Logging  
\- OkHttp HttpLoggingInterceptor: BODY level per debug request/response  
\- Toast messages: feedback immediato per user su errori  
\- Console.log backend: tutti gli errori catturati  
9.2 Error Handling  
\- Network failures: Callback onFailure() con t.getMessage() in Toast  
\- API errors: Parse ErrorResponse da response.errorBody() con Gson  
\- Validation errors: TextInputLayout.setError() per feedback inline  
9.3 Edge Cases Gestiti  
\- Email giÃ  registrata â†’ 409 Conflict con messaggio specifico  
\- Credenziali errate â†’ 401 con messaggio generico (sicurezza)  
\- Token scaduto/invalido â†’ 403 da middleware backend  
\- Render.com cold start â†’ timeout 30s configurato (free tier richiede 60s primo boot)

**10\. Decisioni Architetturali**  
10.1 JWT  
\- Stateless: no session storage server-side (scalabilitÃ )  
\- Mobile-friendly: token salvato localmente, no cookies  
\- Expiration built-in: 30 giorni automatico  
10.2 SharedPreferences  
\- SemplicitÃ : no database locale necessario per pochi dati  
\- Performance: accesso istantaneo in-memory  
\- Security nota: dati plain text (OK per MVP, EncryptedSharedPreferences per produzione)  
10.3 Singleton Pattern  
\- AuthManager e ApiClient evitano istanze multiple  
\- Garantisce stato consistente app-wide  
\- Context leak prevention con context.getApplicationContext()  
10.4 File JSON Backend  
\- No dipendenze: no MongoDB/PostgreSQL setup  
\- Sufficiente per MVP: Render.com persistence disk, scalabile in futuro

**11\. Limitazioni & Future Enhancements**  
11.1 Limitazioni Attuali  
\- Database: JSON non scalabile, no concurrent writes protection  
\- Security: JWT\_SECRET hardcoded (OK per dev, variabile env per prod)  
\- SharedPreferences: plain text (upgrade a EncryptedSharedPreferences raccomandato)  
\- Email verification: non implementata (scelta consapevole per semplicitÃ  MVP)  
\- Token refresh: no automatic refresh (user deve rifare login dopo 30gg)

11.2 Possibili Upgrade  
\- Database reale (PostgreSQL su Render.com)  
\- Email verification con SendGrid/Mailgun  
\- Token refresh endpoint  
\- Social login (Google/Facebook)  
\- Biometric authentication (Fingerprint/Face ID)  
\- Rate limiting backend (express-rate-limit)  
\- Custom font Nunito (menzionato ma non implementato)

**13\. Deployment Notes**

13.1 Render.com Configuration  
\- Root Directory: backend (monorepo structure)  
\- Build Command: npm install  
\- Start Command: npm start  
\- Auto-deploy: GitHub push su main branch  
\- Cold start: \~50s first request dopo inattivitÃ  (free tier)

13.2 Android Configuration  
app/src/main/java/com/ecoapp/android/auth/ApiClient.java:  
\`\`\`java  
private static final String BASE\_URL \= "https://ecoapp-p5gp.onrender.com";  
\`\`\`  
Cambiare per ambienti diversi (localhost, staging, prod).

**14\. Conclusioni**  
Il sistema implementato fornisce una base solida e sicura per l'autenticazione utente in EcoApp, rispettando i requisiti di semplicitÃ  e rapiditÃ . L'architettura modulare permette facile estensione futura senza impattare il lavoro dei colleghi del team. Il design green gaming e l'animazione confetti aggiungono un tocco ludico coerente con la mission eco-friendly dell'app.

2. # **Profilo** {#profilo}

Il presente documento delinea lo stato dell'arte relativo al modulo **Profilo** di EcoApp. La relazione distingue tra le architetture consolidate (full-stack), le componenti in fase di prototipazione (UI/UX con mock data) e le attivitÃ  di sviluppo necessarie per il raggiungimento della piena conformitÃ  ai requisiti di progetto.

## **1\. Architetture Consolidate e Integrazione Full-Stack**

Le seguenti funzionalitÃ  rappresentano il core operativo del modulo, giÃ  pienamente integrate con lâ€™infrastruttura backend tramite API REST:

* **Sincronizzazione Dati Real-time:** Grazie allâ€™implementazione di **Retrofit**, il sistema gestisce il recupero asincrono dei dati persistenti (Nome, Email, Livello, Punti ed Eco-Impact) garantendo lâ€™allineamento costante tra il database server-side e lâ€™interfaccia client.  
* **Persistenza e IntegritÃ  dei Dati:** La logica di aggiornamento Ã¨ attiva. Il sistema supporta richieste **HTTP PUT** per la modifica dei parametri utente, assicurando che le variazioni siano propagate correttamente su tutti i punti di accesso dellâ€™ecosistema EcoApp.  
* **Navigazione Single-Activity:** L'intero modulo Ã¨ orchestrato tramite il **Jetpack Navigation Component**. Questa architettura garantisce transizioni fluide e ottimizzate tra la dashboard del profilo, la gestione contatti e le impostazioni, riducendo l'overhead di memoria.  
* **Engine di Calcolo dei Livelli:** Ãˆ stato sviluppato un algoritmo lato client che converte il punteggio grezzo in indicatori di progresso percentuale, tradotti visivamente da un **CircularProgressIndicator** dinamico che riflette l'avanzamento dell'utente verso il grado successivo.

  ## **2\. Prototipazione dell'Esperienza Utente (Front-end & Simulation)**

Le sezioni seguenti, pur essendo strutturalmente complete a livello di layout, operano temporaneamente con **mock data** per validare i flussi di navigazione e lâ€™ergonomia della UX:

* **Gamification e Tracking Visivo:** Le sezioni "Sfide" e "Badge" utilizzano **RecyclerView** dinamiche. Il progresso delle attivitÃ  Ã¨ rappresentato da **LinearProgressIndicator**, predisposti per il passaggio dai dati locali a flussi di dati provenienti da endpoint backend specifici.  
* **Architettura degli Approfondimenti (BottomSheet):** Ãˆ stata implementata una logica a comparsa tramite `BottomSheetDialog` per il breakdown della CO2 e dei riconoscimenti. Tale sistema Ã¨ giÃ  configurato per gestire contenuti dinamici e descrizioni parametrizzate.  
* **Struttura delle Relazioni Sociali:** La sezione social (Follower/Seguiti) Ã¨ stata definita sotto il profilo del design e dellâ€™ergonomia visiva, in attesa dell'implementazione definitiva delle tabelle relazionali nel database di produzione.

  ## **3\. Gap Analysis e Roadmap di Sviluppo (Backlog)**

In linea con le specifiche definite nei *deliverables* di progetto, le prossime iterazioni si focalizzeranno sulla risoluzione dei seguenti scostamenti:

* **Eco-Wallet (Economia Virtuale):** Implementazione di un sistema di tracciamento per le **Eco-Coins**, differenziando la logica di accumulo della valuta virtuale dai punti esperienza (XP).  
* **Feed di AttivitÃ  e Social Hub:** Sviluppo della griglia di visualizzazione dei contenuti generati dallâ€™utente (post, foto e aggiornamenti di stato) per favorire l'interazione all'interno della community.  
* **Asset Multimediali (Avatar Management):** Integrazione di librerie per il caricamento e la manipolazione di immagini (es. **Glide** o **Picasso**) per permettere l'upload di fotografie reali e la gestione degli avatar personalizzati.  
* **Integrazione Obiettivi Agenda 2030:** Mappatura dei traguardi ambientali con i 17 obiettivi ONU per lo sviluppo sostenibile, integrando i riferimenti grafici e testuali all'interno dei dettagli di ogni quest.

3. #  **Quest** {#quest}

## **1\. Panoramica**

Il modulo Quest costituisce il cuore dell'esperienza di *gamification* di EcoApp. Ãˆ stato progettato per incentivare comportamenti eco-sostenibili attraverso un sistema di missioni monitorabili. Il sistema permette la visualizzazione di una lista di sfide attive e l'approfondimento di ciascuna di esse tramite una vista di dettaglio che integra obiettivi, ricompense e tracciamento del progresso in tempo reale.

## **2\. Architettura Android**

### **2.1 Struttura del Package**

Il codice relativo alle missioni Ã¨ organizzato nel package `com.example.ecoapp.quest_files/`, mantenendo una netta separazione tra la logica dei dati (modelli) e la logica di presentazione:

```
quest_files/
â”œâ”€â”€ QuestFragment.java        (Visualizzazione lista)
â”œâ”€â”€ QuestDetailFragment.java  (Visualizzazione dettaglio)
â”œâ”€â”€ QuestAdapter.java         (Bridge dati-UI per RecyclerView)
â””â”€â”€ models/
    â””â”€â”€ Quest.java            (Modello dati POJO)
```

### **2.2 Componenti Chiave**

#### **Quest.java (Modello Dati)**

Rappresenta l'entitÃ  fondamentale della missione. Include attributi per:

* **Identificazione**: `id`, `name`, `type` (es. Alimentation, Mobility).  
* **Gamification**: `reward_points`, `actual_progress`, `max_progress`.  
* **Contenuto**: `description`, `imageResId`.  
* **SostenibilitÃ **: `images_eu_goals` (array di riferimenti alle icone degli obiettivi ONU 2030).

#### **QuestFragment.java**

* Gestisce la visualizzazione principale delle missioni disponibili.  
* Utilizza una `RecyclerView` per garantire performance elevate nello scrolling di liste potenzialmente lunghe.  
* Implementa la logica di navigazione verso il dettaglio tramite `Navigation Component`, passando l'ID della quest selezionata come argomento.

#### **QuestDetailFragment.java**

* Implementa una visualizzazione gerarchica avanzata:  
  * **Top**: Immagine rappresentativa della missione.  
  * **Center**: Corpo informativo scorrevole (`NestedScrollView`) contenente nome, descrizione estesa e tipologia.  
  * **Social Impact**: Sezione dinamica dedicata alle icone degli obiettivi EU Sustainable Development Goals.  
  * **Fixed Bottom**: Una barra di progresso persistente ancorata al fondo della schermata per mantenere sempre visibile l'avanzamento dell'utente.

#### **QuestAdapter.java**

* Implementa il pattern `ViewHolder` per il riciclo efficiente delle viste.  
* Gestisce il binding dinamico dei dati, inclusa la configurazione delle `ProgressBar` e delle immagini di anteprima.  
* Definisce l'interfaccia `OnQuestClick` per il disaccoppiamento della logica di click.

## **3\. Design UI e UX**

### **3.1 Layout Features**

* **Item Quest (`item_quest.xml`)**: Utilizzo di `MaterialCardView` con corner radius di 16dp ed elevazione di 4dp per un look moderno e "pulito".  
* **Dettaglio Quest (`fragment_quest_detail.xml`)**:  
  * Layout basato su `ConstraintLayout`.  
  * Immagini in `scaleType="centerCrop"` per una resa visiva cinematografica.  
  * Utilizzo di colori semantici (es. `#4CAF50` per i Reward Points).

  ### **3.2 AccessibilitÃ  e Localizzazione**

* **Content Descriptions**: Gestione degli attributi `contentDescription` (settaggio a `@null` per elementi decorativi) per garantire la compatibilitÃ  con TalkBack.  
* **Resource Strings**: Utilizzo di placeholder dinamici nel file `strings.xml` per evitare la concatenazione di stringhe nel codice Java (es. `reward_label`).

XML

```
<string name="reward_label">Reward: %1$d coins</string>
<string name="quest_image_desc">Immagine della quest</string>
```

## **4\. Logica di Business e Flussi**

1. **Inizializzazione**: All'apertura del `QuestFragment`, viene generata una lista di oggetti `Quest` (attualmente via mock data, predisposta per fetch API).  
2. **Selezione**: Al click su una card, l'adapter comunica l'ID al fragment padre.  
3. **Navigazione**: Il `NavController` esegue la transizione verso `QuestDetailFragment`.  
4. **Rendering Dettaglio**: Il fragment di dettaglio riceve l'ID, recupera l'istanza della Quest e popola dinamicamente i campi. Le icone degli obiettivi EU Goals vengono generate a runtime e inserite in un contenitore orizzontale.

## **5\. Stato dello Sviluppo e Roadmap**

### **5.1 FunzionalitÃ  Completate**

* \[x\] Struttura dati `Quest` con supporto per obiettivi ONU 2030\.  
* \[x\] Visualizzazione a lista con `RecyclerView` e `CardView`.  
* \[x\] Navigazione sicura tra lista e dettaglio.  
* \[x\] Layout dettaglio con barra di progresso fissa e scrolling intelligente.

  ### **5.2 Sviluppi Futuri (Backlog)**

* **Integrazione Backend**: Sostituzione della lista locale con chiamate `GET /api/quests` tramite Retrofit.  
* **Update Progresso**: Implementazione di pulsanti di azione nel dettaglio per aggiornare lo stato di avanzamento della missione (chiamate `POST`).  
* **Filtri**: Aggiunta di chip per filtrare le missioni per categoria (es. solo "Mobility").  
* **Mascotte**: Integrazione di animazioni Lottie per celebrare il completamento di una missione.